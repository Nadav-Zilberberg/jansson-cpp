# Jansson C Linkage Tests

This directory contains C linkage tests for the Jansson JSON library. These tests verify that the C API functions correctly when linking against the shared library.

## Files in this directory

- `jansson.h` - The main C API header file
- `jansson_config.h` - Configuration header generated by CMake
- `libjansson.so*` - The shared library files
- `test_basic.c` - Basic functionality tests (creation, arrays, objects, serialization)
- `test_advanced.c` - Advanced tests (reference counting, deep copy, iteration, error handling)
- `test_error_handling.c` - Comprehensive error handling tests
- `CMakeLists.txt` - CMake configuration for building and running tests

## Prerequisites

- C compiler (gcc or clang)
- CMake (version 3.10 or higher)
- Make

## Building and Running Tests

### Method 1: Using CMake (Recommended)

```bash
# Create build directory
mkdir build
cd build

# Configure with CMake
cmake ..

# Build tests
make

# Run all tests
make run_tests

# Or run individual tests
./test_basic
./test_advanced
./test_error_handling
```

### Method 2: Manual Compilation

```bash
# Compile individual tests
gcc -o test_basic test_basic.c -L. -ljansson -I.
gcc -o test_advanced test_advanced.c -L. -ljansson -I.
gcc -o test_error_handling test_error_handling.c -L. -ljansson -I.

# Set library path and run tests
export LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH
./test_basic
./test_advanced
./test_error_handling
```

## Test Output

Each test will output:
- A header indicating which test is running
- Checkmarks (✓) for each successful test case
- Error messages if any tests fail
- A summary at the end

Example output:
```
Starting C Linkage Tests for Jansson Library
============================================

=== Testing Basic JSON Creation ===
✓ Null value created successfully
✓ Boolean values created successfully
✓ Integer value created successfully
✓ Real value created successfully
✓ String value created successfully
✓ All basic creation tests passed!

All tests passed successfully! ✓
```

## Troubleshooting

### Library not found
If you get an error about libjansson.so not being found:
```bash
export LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH
```

### Compilation errors
Make sure you have the jansson.h and jansson_config.h files in the same directory as your test files.

### Runtime errors
If tests crash or behave unexpectedly, check that:
1. The shared library was built correctly
2. All header files are present
3. You're using a compatible C compiler

## Test Coverage

These tests cover:
- Basic JSON value creation (null, boolean, integer, real, string)
- Array operations (creation, appending, accessing)
- Object operations (creation, property setting/getting)
- Serialization and deserialization
- Reference counting
- Deep copying
- Iteration over objects and arrays
- Error handling for invalid inputs
- Memory management
- Type checking
- Bounds checking

## Integration with CI/CD

These tests can be integrated into continuous integration pipelines:

```bash
# Build and test in one command
mkdir build && cd build
cmake .. && make && ctest --verbose
```

The tests will return exit code 0 on success and non-zero on failure, making them suitable for automated testing environments.
